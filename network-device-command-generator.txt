Function ProcessDevice(ByVal deviceInfo As Dictionary, ByVal deviceName As String, ByVal aristaTemplate As String, ByVal ciscoTemplate As String, ByVal avocentTemplate As String, ByVal ws As Worksheet, ByVal startColumn As Long) As Long
    Dim deviceType As String
    Dim interfaceList As String
    Dim commandList As String
    Dim commandLines() As String
    Dim i As Long
    Dim currentRow As Long
    Dim port As Variant
    Dim portStatus As String
    
    deviceType = LCase(CStr(deviceInfo("type")))
    
    ' Skip if device type is server
    If deviceType = "server" Then
        ProcessDevice = startColumn
        Exit Function
    End If
    
    ' Create interface list (using Dictionary keys to avoid duplicates)
    interfaceList = Join(deviceInfo("ports").Keys, ",")
    
    ' Generate command list based on device type
    Select Case deviceType
        Case "arista"
            commandList = Replace(aristaTemplate, "[interfaces]", interfaceList)
        Case "cisco"
            commandList = Replace(ciscoTemplate, "[interfaces]", interfaceList)
        Case "console"
            commandList = Replace(avocentTemplate, "[interfaces]", interfaceList)
        Case Else
            ProcessDevice = startColumn
            Exit Function ' Skip unknown device types
    End Select
    
    ' Write device name as header
    ws.Cells(1, startColumn).Value = deviceName
    ws.Cells(1, startColumn).Font.Bold = True
    
    ' Add white space
    currentRow = 3
    
    ' Write Device Info section
    ws.Cells(currentRow, startColumn).Value = "Device Info:"
    ws.Cells(currentRow, startColumn).Font.Bold = True
    currentRow = currentRow + 1
    
    ws.Cells(currentRow, startColumn).Value = "Type: " & deviceType
    currentRow = currentRow + 1
    
    ws.Cells(currentRow, startColumn).Value = "Ports:"
    currentRow = currentRow + 1
    
    For Each port In deviceInfo("ports")
        portStatus = deviceInfo("ports")(port)
        ws.Cells(currentRow, startColumn).Value = "  " & port & " (" & portStatus & ")"
        currentRow = currentRow + 1
    Next port
    
    ' Add white space
    currentRow = currentRow + 2
    
    ' Write Commands header
    ws.Cells(currentRow, startColumn).Value = "Commands:"
    ws.Cells(currentRow, startColumn).Font.Bold = True
    currentRow = currentRow + 1
    
    ' Write commands
    commandLines = Split(commandList, vbNewLine)
    For i = 0 To UBound(commandLines)
        ws.Cells(currentRow + i, startColumn).Value = commandLines(i)
    Next i
    
    ' Add white space at the end
    currentRow = currentRow + UBound(commandLines) + 3
    
    ' Add a border around the entire device section
    ws.Range(ws.Cells(1, startColumn), ws.Cells(currentRow, startColumn)).BorderAround Weight:=xlMedium
    
    ' Return the next column to write to
    ProcessDevice = startColumn + 1
End Function
