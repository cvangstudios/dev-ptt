<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wireshark Filter Generator - Professional Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #00b4d8 0%, #0077be 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInDown 0.8s ease;
        }
        
        h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .shark-logo {
            font-size: 1.2em;
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.95;
        }
        
        .main-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: fadeInUp 0.8s ease;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            color: #666;
            font-size: 16px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .tab:hover {
            color: #0077be;
        }
        
        .tab.active {
            color: #0077be;
            font-weight: 600;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #00b4d8, #0077be);
            animation: slideIn 0.3s ease;
        }
        
        .nx-switch {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            margin-left: auto;
        }
        
        @keyframes slideIn {
            from { width: 0; }
            to { width: 100%; }
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .quick-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .quick-filter-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
            border: 1px solid #ccc;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .quick-filter-btn:hover {
            background: linear-gradient(135deg, #00b4d8, #0077be);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,119,190,0.3);
        }
        
        .quick-filter-btn.active {
            background: linear-gradient(135deg, #00b4d8, #0077be);
            color: white;
        }
        
        .form-section {
            margin-bottom: 25px;
        }
        
        .form-section h3 {
            color: #333;
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 4px solid #0077be;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 500;
            color: #555;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        input, select, textarea {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #0077be;
            box-shadow: 0 0 0 3px rgba(0,119,190,0.1);
        }
        
        select {
            cursor: pointer;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
            flex-wrap: wrap;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #00b4d8, #0077be);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,119,190,0.3);
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #666;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .output-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
        }
        
        .output-section h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filter-output {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            overflow-x: auto;
            min-height: 60px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .copy-btn {
            padding: 8px 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .copy-btn:hover {
            background: #45a049;
            transform: translateY(-1px);
        }
        
        .copy-btn.copied {
            background: #2196F3;
        }
        
        .visual-builder {
            background: #f9f9f9;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .filter-condition {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .filter-condition select, .filter-condition input {
            flex: 1;
            min-width: 0;
        }
        
        .add-condition-btn {
            padding: 8px 16px;
            background: #0077be;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .add-condition-btn:hover {
            background: #005a8b;
        }
        
        .remove-condition-btn {
            padding: 8px 12px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .info-box.warning {
            background: #fff3e0;
            border-left-color: #ff9800;
        }
        
        .info-box.success {
            background: #e8f5e9;
            border-left-color: #4caf50;
        }
        
        .info-box.error {
            background: #ffebee;
            border-left-color: #f44336;
        }
        
        .info-box h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .info-box.warning h4 {
            color: #f57c00;
        }
        
        .info-box.success h4 {
            color: #388e3c;
        }
        
        .info-box.error h4 {
            color: #c62828;
        }
        
        .performance-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .perf-fast {
            background: #4caf50;
            color: white;
        }
        
        .perf-medium {
            background: #ff9800;
            color: white;
        }
        
        .perf-slow {
            background: #f44336;
            color: white;
        }
        
        .scenario-card {
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            border: 2px solid #ddd;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .scenario-card:hover {
            border-color: #0077be;
            box-shadow: 0 8px 20px rgba(0,119,190,0.2);
            transform: translateY(-3px);
        }
        
        .scenario-card h4 {
            color: #0077be;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .template-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .template-card:hover {
            border-color: #0077be;
            box-shadow: 0 5px 15px rgba(0,119,190,0.2);
            transform: translateY(-2px);
        }
        
        .filter-templates {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .expert-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .expert-filter-btn {
            padding: 10px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .expert-filter-btn:hover {
            border-color: #0077be;
            background: #e3f2fd;
        }
        
        .expert-filter-btn.selected {
            background: #0077be;
            color: white;
            border-color: #0077be;
        }
        
        .protocol-category {
            margin-bottom: 20px;
        }
        
        .protocol-category h4 {
            color: #0077be;
            margin-bottom: 10px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 6px;
        }
        
        .filter-history {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .history-item {
            padding: 8px 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-item:hover {
            background: #e3f2fd;
            border-color: #0077be;
        }
        
        .favorite-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: #ffc107;
        }
        
        .help-section {
            margin-bottom: 30px;
        }
        
        .help-section h3 {
            color: #0077be;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .help-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .help-card {
            background: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
        }
        
        .help-card h4 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .help-card p {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #0077be, #00b4d8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-card h5 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .stat-card .stat-value {
            font-size: 24px;
            font-weight: bold;
        }
        
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .tabs {
                overflow-x: auto;
            }
            
            .filter-condition {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><span class="shark-logo">🦈</span> Wireshark Filter Generator <span class="shark-logo">🦈</span></h1>
            <p class="subtitle">Professional packet analysis filter builder with advanced capabilities</p>
        </header>
        
        <div class="main-panel">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('generator')">Filter Generator</button>
                <button class="tab" onclick="switchTab('visual')">Visual Builder</button>
                <button class="tab" onclick="switchTab('scenarios')">Scenarios</button>
                <button class="tab" onclick="switchTab('expert')">Expert Analysis</button>
                <button class="tab" onclick="switchTab('templates')">Templates</button>
                <button class="tab" onclick="switchTab('reference')">Reference</button>
                <button class="tab" onclick="switchTab('help')">📚 Help</button>
                <button class="tab nx-switch" onclick="window.open('ethanalyzer-generator.html', '_blank')">🔄 Switch to NX-OS</button>
            </div>
            
            <!-- Filter Generator Tab -->
            <div id="generator" class="tab-content active">
                <!-- Quick Filter Buttons -->
                <div class="quick-filters">
                    <button class="quick-filter-btn" onclick="applyQuickFilter('tcp.analysis.flags')">TCP Issues</button>
                    <button class="quick-filter-btn" onclick="applyQuickFilter('frame.time_delta > 0.1')">Slow Response</button>
                    <button class="quick-filter-btn" onclick="applyQuickFilter('expert.severity == error')">Errors Only</button>
                    <button class="quick-filter-btn" onclick="applyQuickFilter('!arp and !broadcast')">No ARP/Broadcast</button>
                    <button class="quick-filter-btn" onclick="applyQuickFilter('frame.len > 1400')">Large Packets</button>
                    <button class="quick-filter-btn" onclick="applyQuickFilter('tcp.analysis.retransmission')">Retransmissions</button>
                    <button class="quick-filter-btn" onclick="applyQuickFilter('http.response.code >= 400')">HTTP Errors</button>
                    <button class="quick-filter-btn" onclick="applyQuickFilter('dns.time > 0.5')">Slow DNS</button>
                </div>
                
                <form id="filterForm">
                    <div class="form-section">
                        <h3>Basic Filters</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="filterType">Filter Type</label>
                                <select id="filterType" onchange="updateFilterMode()">
                                    <option value="display">Display Filter (View)</option>
                                    <option value="capture">Capture Filter (BPF)</option>
                                    <option value="both">Both Types</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="interface">Capture Interface</label>
                                <select id="interface">
                                    <option value="any">Any Interface</option>
                                    <option value="ethernet">Ethernet</option>
                                    <option value="wifi">Wi-Fi</option>
                                    <option value="loopback">Loopback</option>
                                    <option value="usb">USB</option>
                                    <option value="vpn">VPN/TUN</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="captureMode">Capture Mode</label>
                                <select id="captureMode">
                                    <option value="normal">Normal</option>
                                    <option value="promiscuous">Promiscuous</option>
                                    <option value="monitor">Monitor (WiFi)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="outputFormat">Output Format</label>
                                <select id="outputFormat">
                                    <option value="wireshark">Wireshark GUI</option>
                                    <option value="tshark">tshark Command</option>
                                    <option value="dumpcap">dumpcap Command</option>
                                    <option value="tcpdump">tcpdump Compatible</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Network Layer Filters</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="srcIP">Source IP</label>
                                <input type="text" id="srcIP" placeholder="192.168.1.1 or 192.168.1.0/24">
                            </div>
                            <div class="form-group">
                                <label for="dstIP">Destination IP</label>
                                <input type="text" id="dstIP" placeholder="10.0.0.1 or 10.0.0.0/8">
                            </div>
                            <div class="form-group">
                                <label for="anyIP">Any IP (src or dst)</label>
                                <input type="text" id="anyIP" placeholder="172.16.1.1">
                            </div>
                            <div class="form-group">
                                <label for="ipOperator">IP Operator</label>
                                <select id="ipOperator">
                                    <option value="==">Equals (==)</option>
                                    <option value="!=">Not Equals (!=)</option>
                                    <option value="contains">Contains</option>
                                    <option value="in">In Subnet</option>
                                    <option value="matches">Matches (regex)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Transport Layer Filters</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="srcPort">Source Port</label>
                                <input type="text" id="srcPort" placeholder="80 or 1024-65535">
                            </div>
                            <div class="form-group">
                                <label for="dstPort">Destination Port</label>
                                <input type="text" id="dstPort" placeholder="443 or {80 443 8080}">
                            </div>
                            <div class="form-group">
                                <label for="protocol">Protocol</label>
                                <select id="protocol" onchange="showProtocolOptions()">
                                    <option value="">Any Protocol</option>
                                    <optgroup label="Common">
                                        <option value="tcp">TCP</option>
                                        <option value="udp">UDP</option>
                                        <option value="icmp">ICMP</option>
                                        <option value="arp">ARP</option>
                                    </optgroup>
                                    <optgroup label="Application">
                                        <option value="http">HTTP</option>
                                        <option value="https">HTTPS/TLS</option>
                                        <option value="dns">DNS</option>
                                        <option value="dhcp">DHCP</option>
                                        <option value="ftp">FTP</option>
                                        <option value="ssh">SSH</option>
                                        <option value="telnet">Telnet</option>
                                        <option value="smtp">SMTP</option>
                                        <option value="pop">POP3</option>
                                        <option value="imap">IMAP</option>
                                    </optgroup>
                                    <optgroup label="VoIP/Media">
                                        <option value="sip">SIP</option>
                                        <option value="rtp">RTP</option>
                                        <option value="rtcp">RTCP</option>
                                        <option value="h323">H.323</option>
                                        <option value="rtsp">RTSP</option>
                                    </optgroup>
                                    <optgroup label="Database">
                                        <option value="mysql">MySQL</option>
                                        <option value="postgresql">PostgreSQL</option>
                                        <option value="mssql">MS SQL/TDS</option>
                                        <option value="oracle">Oracle/TNS</option>
                                        <option value="mongodb">MongoDB</option>
                                        <option value="redis">Redis</option>
                                    </optgroup>
                                    <optgroup label="Cloud/Container">
                                        <option value="kubernetes">Kubernetes</option>
                                        <option value="docker">Docker</option>
                                        <option value="aws">AWS</option>
                                        <option value="azure">Azure</option>
                                        <option value="gcp">GCP</option>
                                    </optgroup>
                                    <optgroup label="IoT/SCADA">
                                        <option value="mqtt">MQTT</option>
                                        <option value="coap">CoAP</option>
                                        <option value="modbus">Modbus</option>
                                        <option value="dnp3">DNP3</option>
                                        <option value="bacnet">BACnet</option>
                                    </optgroup>
                                    <optgroup label="Routing">
                                        <option value="ospf">OSPF</option>
                                        <option value="bgp">BGP</option>
                                        <option value="eigrp">EIGRP</option>
                                        <option value="rip">RIP</option>
                                        <option value="isis">IS-IS</option>
                                    </optgroup>
                                    <optgroup label="Layer 2">
                                        <option value="stp">STP</option>
                                        <option value="cdp">CDP</option>
                                        <option value="lldp">LLDP</option>
                                        <option value="vlan">VLAN</option>
                                        <option value="lacp">LACP</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="tcpFlags">TCP Flags</label>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="tcpSyn"><label for="tcpSyn">SYN</label>
                                    <input type="checkbox" id="tcpAck"><label for="tcpAck">ACK</label>
                                    <input type="checkbox" id="tcpFin"><label for="tcpFin">FIN</label>
                                    <input type="checkbox" id="tcpRst"><label for="tcpRst">RST</label>
                                    <input type="checkbox" id="tcpPsh"><label for="tcpPsh">PSH</label>
                                    <input type="checkbox" id="tcpUrg"><label for="tcpUrg">URG</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Advanced Filters</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="frameContains">Frame Contains</label>
                                <input type="text" id="frameContains" placeholder="Search in entire frame">
                            </div>
                            <div class="form-group">
                                <label for="regex">Regex Pattern</label>
                                <input type="text" id="regex" placeholder=".*pattern.*">
                            </div>
                            <div class="form-group">
                                <label for="frameLen">Frame Length</label>
                                <select id="frameLenOp">
                                    <option value="==">=</option>
                                    <option value="!=">!=</option>
                                    <option value=">">></option>
                                    <option value="<"><</option>
                                    <option value=">=">=></option>
                                    <option value="<="><=</option>
                                </select>
                                <input type="number" id="frameLen" placeholder="1500" style="margin-top: 5px;">
                            </div>
                            <div class="form-group">
                                <label for="vlanId">VLAN ID</label>
                                <input type="text" id="vlanId" placeholder="100 or 100-200">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Time-Based Filters</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="timeDelta">Frame Time Delta ></label>
                                <input type="number" step="0.001" id="timeDelta" placeholder="0.1 (seconds)">
                            </div>
                            <div class="form-group">
                                <label for="responseTime">Response Time ></label>
                                <input type="number" step="0.001" id="responseTime" placeholder="1.0 (seconds)">
                            </div>
                            <div class="form-group">
                                <label for="timeRange">Time Range</label>
                                <input type="text" id="timeRange" placeholder="2024-01-01 00:00:00">
                            </div>
                            <div class="form-group">
                                <label for="relativeTime">Relative Time</label>
                                <input type="text" id="relativeTime" placeholder="10-20 (seconds from start)">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Analysis Filters</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>TCP Analysis</label>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="tcpRetrans"><label for="tcpRetrans">Retransmissions</label>
                                    <input type="checkbox" id="tcpZeroWin"><label for="tcpZeroWin">Zero Window</label>
                                    <input type="checkbox" id="tcpOutOrder"><label for="tcpOutOrder">Out of Order</label>
                                    <input type="checkbox" id="tcpDupAck"><label for="tcpDupAck">Duplicate ACK</label>
                                    <input type="checkbox" id="tcpFastRetrans"><label for="tcpFastRetrans">Fast Retrans</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="expertInfo">Expert Info Level</label>
                                <select id="expertInfo">
                                    <option value="">Any</option>
                                    <option value="error">Errors</option>
                                    <option value="warning">Warnings</option>
                                    <option value="note">Notes</option>
                                    <option value="chat">Chats</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="stream">Stream Number</label>
                                <input type="number" id="stream" placeholder="TCP/UDP stream number">
                            </div>
                            <div class="form-group">
                                <label for="httpStatus">HTTP Status Code</label>
                                <input type="text" id="httpStatus" placeholder="404 or >= 400">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Custom Filter Expression</h3>
                        <div class="form-group">
                            <label for="customFilter">Manual Filter Entry</label>
                            <textarea id="customFilter" rows="3" placeholder="Enter custom Wireshark display filter or BPF capture filter"></textarea>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button type="button" class="btn-primary" onclick="generateFilter()">Generate Filter</button>
                        <button type="button" class="btn-secondary" onclick="validateFilter()">Validate</button>
                        <button type="button" class="btn-secondary" onclick="clearForm()">Clear All</button>
                        <button type="button" class="btn-secondary" onclick="saveToHistory()">Save to History</button>
                        <button type="button" class="btn-secondary" onclick="exportFilter()">Export</button>
                    </div>
                </form>
                
                <div class="output-section" id="outputSection" style="display: none;">
                    <h3>
                        Generated Filter
                        <span class="performance-indicator" id="perfIndicator"></span>
                        <button class="copy-btn" onclick="copyFilter()">📋 Copy</button>
                    </h3>
                    <div class="filter-output" id="filterOutput"></div>
                    
                    <div class="info-box" style="margin-top: 20px;">
                        <h4>Filter Analysis:</h4>
                        <div id="filterAnalysis"></div>
                    </div>
                    
                    <div class="filter-history" id="filterHistory">
                        <h4>Recent Filters</h4>
                        <div id="historyList"></div>
                    </div>
                </div>
            </div>
            
            <!-- Visual Builder Tab -->
            <div id="visual" class="tab-content">
                <h3>Visual Filter Builder</h3>
                <div class="info-box">
                    <h4>Build complex filters visually</h4>
                    <p>Add conditions and combine them with AND/OR operators. The filter will be generated automatically.</p>
                </div>
                
                <div class="visual-builder">
                    <div id="visualConditions">
                        <div class="filter-condition" id="condition1">
                            <select class="field-select" onchange="updateFieldOptions(1)">
                                <option value="">Select Field...</option>
                                <option value="ip.src">Source IP</option>
                                <option value="ip.dst">Destination IP</option>
                                <option value="tcp.port">TCP Port</option>
                                <option value="udp.port">UDP Port</option>
                                <option value="http.request.method">HTTP Method</option>
                                <option value="http.response.code">HTTP Status</option>
                                <option value="dns.qry.name">DNS Query</option>
                                <option value="frame.len">Frame Length</option>
                                <option value="tcp.flags">TCP Flags</option>
                            </select>
                            <select class="operator-select">
                                <option value="==">equals</option>
                                <option value="!=">not equals</option>
                                <option value=">">greater than</option>
                                <option value="<">less than</option>
                                <option value="contains">contains</option>
                                <option value="matches">matches</option>
                            </select>
                            <input type="text" class="value-input" placeholder="Value">
                            <select class="logic-operator">
                                <option value="and">AND</option>
                                <option value="or">OR</option>
                            </select>
                        </div>
                    </div>
                    <button class="add-condition-btn" onclick="addVisualCondition()">+ Add Condition</button>
                    <button class="btn-primary" onclick="buildVisualFilter()" style="margin-left: 10px;">Build Filter</button>
                </div>
                
                <div class="output-section" id="visualOutput" style="display: none; margin-top: 20px;">
                    <h3>Visual Builder Output</h3>
                    <div class="filter-output" id="visualFilterOutput"></div>
                </div>
            </div>
            
            <!-- Scenarios Tab -->
            <div id="scenarios" class="tab-content">
                <h3>Common Troubleshooting Scenarios</h3>
                
                <div class="stats-section">
                    <div class="stat-card">
                        <h5>Total Scenarios</h5>
                        <div class="stat-value">50+</div>
                    </div>
                    <div class="stat-card">
                        <h5>Categories</h5>
                        <div class="stat-value">12</div>
                    </div>
                    <div class="stat-card">
                        <h5>Quick Fixes</h5>
                        <div class="stat-value">200+</div>
                    </div>
                    <div class="stat-card">
                        <h5>Protocols</h5>
                        <div class="stat-value">80+</div>
                    </div>
                </div>
                
                <div class="info-box warning">
                    <h4>💡 Pro Tip</h4>
                    <p>Each scenario includes optimized filters, what to look for, and resolution steps. Click any scenario to load its filters.</p>
                </div>
                
                <div id="scenariosList">
                    <!-- Scenarios will be loaded by JavaScript -->
                </div>
            </div>
            
            <!-- Expert Analysis Tab -->
            <div id="expert" class="tab-content">
                <h3>Expert Information Filters</h3>
                
                <div class="form-section">
                    <h4>Severity Levels</h4>
                    <div class="expert-filters">
                        <div class="expert-filter-btn" onclick="applyExpertFilter('expert.severity == error')">
                            🔴 Errors
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('expert.severity == warning')">
                            🟡 Warnings
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('expert.severity == note')">
                            🔵 Notes
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('expert.severity == chat')">
                            ⚪ Chats
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h4>Expert Groups</h4>
                    <div class="expert-filters">
                        <div class="expert-filter-btn" onclick="applyExpertFilter('expert.group == malformed')">
                            Malformed
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('expert.group == sequence')">
                            Sequence
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('expert.group == response_code')">
                            Response Code
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('expert.group == request_code')">
                            Request Code
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('expert.group == undecoded')">
                            Undecoded
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('expert.group == reassemble')">
                            Reassemble
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('expert.group == protocol')">
                            Protocol
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('expert.group == security')">
                            Security
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h4>TCP Analysis Flags</h4>
                    <div class="expert-filters">
                        <div class="expert-filter-btn" onclick="applyExpertFilter('tcp.analysis.retransmission')">
                            Retransmission
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('tcp.analysis.fast_retransmission')">
                            Fast Retransmission
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('tcp.analysis.spurious_retransmission')">
                            Spurious Retransmission
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('tcp.analysis.out_of_order')">
                            Out of Order
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('tcp.analysis.lost_segment')">
                            Lost Segment
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('tcp.analysis.duplicate_ack')">
                            Duplicate ACK
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('tcp.analysis.zero_window')">
                            Zero Window
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('tcp.analysis.window_update')">
                            Window Update
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('tcp.analysis.keep_alive')">
                            Keep Alive
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('tcp.analysis.window_full')">
                            Window Full
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h4>Security Analysis</h4>
                    <div class="expert-filters">
                        <div class="expert-filter-btn" onclick="applyExpertFilter('tcp.flags.syn==1 and tcp.flags.ack==0')">
                            Port Scan (SYN)
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('icmp.type==3')">
                            ICMP Unreachable
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('dns.qry.name.len > 50')">
                            DNS Tunneling
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('http.request.method == POST and http.content_length > 1000000')">
                            Large POST
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('ssl.alert_message')">
                            SSL Alerts
                        </div>
                        <div class="expert-filter-btn" onclick="applyExpertFilter('arp.duplicate-address-detected')">
                            ARP Spoofing
                        </div>
                    </div>
                </div>
                
                <div class="output-section" id="expertOutput" style="margin-top: 20px;">
                    <h3>Combined Expert Filter</h3>
                    <div class="filter-output" id="expertFilterOutput"></div>
                    <button class="btn-primary" onclick="applyExpertToMain()">Apply to Main Filter</button>
                </div>
            </div>
            
            <!-- Templates Tab -->
            <div id="templates" class="tab-content">
                <h3>Filter Templates Library</h3>
                <div class="filter-templates" id="templatesList">
                    <!-- Templates will be loaded by JavaScript -->
                </div>
            </div>
            
            <!-- Reference Tab -->
            <div id="reference" class="tab-content">
                <h3>Wireshark Filter Reference</h3>
                
                <div class="info-box">
                    <h4>Display Filter Operators</h4>
                    <ul>
                        <li><code>==</code> - Equal</li>
                        <li><code>!=</code> - Not equal</li>
                        <li><code>></code> - Greater than</li>
                        <li><code><</code> - Less than</li>
                        <li><code>>=</code> - Greater than or equal</li>
                        <li><code><=</code> - Less than or equal</li>
                        <li><code>contains</code> - Protocol, field or slice contains value</li>
                        <li><code>matches</code> or <code>~</code> - Regular expression match</li>
                        <li><code>in</code> - Value is in set {}</li>
                    </ul>
                </div>
                
                <div class="info-box">
                    <h4>Logical Operators</h4>
                    <ul>
                        <li><code>and</code> or <code>&&</code> - Logical AND</li>
                        <li><code>or</code> or <code>||</code> - Logical OR</li>
                        <li><code>not</code> or <code>!</code> - Logical NOT</li>
                        <li><code>xor</code> or <code>^^</code> - Logical XOR</li>
                    </ul>
                </div>
                
                <div class="info-box">
                    <h4>Common Display Filters</h4>
                    <ul>
                        <li><code>ip.addr == 192.168.1.1</code> - IP address (src or dst)</li>
                        <li><code>tcp.port == 80</code> - TCP port (src or dst)</li>
                        <li><code>http.request.method == "GET"</code> - HTTP GET requests</li>
                        <li><code>dns.qry.name contains "google"</code> - DNS queries containing "google"</li>
                        <li><code>tcp.flags.syn == 1</code> - TCP SYN flag set</li>
                        <li><code>frame.len > 1500</code> - Frames larger than 1500 bytes</li>
                        <li><code>tcp.analysis.retransmission</code> - TCP retransmissions</li>
                        <li><code>expert.severity == error</code> - Expert Info errors</li>
                    </ul>
                </div>
                
                <div class="info-box">
                    <h4>Capture Filter Syntax (BPF)</h4>
                    <ul>
                        <li><code>host 192.168.1.1</code> - Traffic to/from host</li>
                        <li><code>net 192.168.0.0/16</code> - Traffic to/from network</li>
                        <li><code>port 80</code> - Traffic on port 80</li>
                        <li><code>tcp</code> - TCP traffic only</li>
                        <li><code>src host 10.1.1.1</code> - Traffic from specific host</li>
                        <li><code>dst port 443</code> - Traffic to specific port</li>
                        <li><code>not arp</code> - Exclude ARP traffic</li>
                        <li><code>greater 1000</code> - Packets larger than 1000 bytes</li>
                    </ul>
                </div>
            </div>
            
            <!-- Help Tab -->
            <div id="help" class="tab-content">
                <div class="help-section">
                    <h3>📖 Comprehensive Filter Guide</h3>
                    
                    <div class="protocol-category">
                        <h4>🔍 Filter Operators Mastery</h4>
                        <div class="help-grid">
                            <div class="help-card">
                                <h4>Basic Operators</h4>
                                <p><strong>When to use:</strong> Simple comparisons and exact matches.<br>
                                <code>==, !=, >, <, >=, <=</code><br>
                                <strong>Performance:</strong> ⚡ Fast<br>
                                <strong>Example:</strong> <code>ip.addr == 192.168.1.1</code></p>
                            </div>
                            <div class="help-card">
                                <h4>Contains Operator</h4>
                                <p><strong>When to use:</strong> Search within fields or entire frames.<br>
                                <code>contains</code><br>
                                <strong>Performance:</strong> 🔄 Medium<br>
                                <strong>Example:</strong> <code>http.request.uri contains "api"</code><br>
                                <strong>Tip:</strong> Slower than exact matches but very flexible.</p>
                            </div>
                            <div class="help-card">
                                <h4>Matches (Regex)</h4>
                                <p><strong>When to use:</strong> Complex pattern matching.<br>
                                <code>matches or ~</code><br>
                                <strong>Performance:</strong> 🐢 Slow<br>
                                <strong>Example:</strong> <code>http.host matches ".*\\.google\\.com$"</code><br>
                                <strong>Warning:</strong> CPU intensive, use sparingly.</p>
                            </div>
                            <div class="help-card">
                                <h4>In Operator</h4>
                                <p><strong>When to use:</strong> Check multiple values efficiently.<br>
                                <code>in {}</code><br>
                                <strong>Performance:</strong> ⚡ Fast<br>
                                <strong>Example:</strong> <code>tcp.port in {80 443 8080}</code><br>
                                <strong>Benefit:</strong> Faster than multiple OR conditions.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="protocol-category">
                        <h4>🌐 Protocol Deep Dives</h4>
                        <div class="help-grid">
                            <div class="help-card">
                                <h4>HTTP/HTTPS Analysis</h4>
                                <p><strong>Key fields:</strong><br>
                                • <code>http.request.method</code> - GET, POST, etc.<br>
                                • <code>http.response.code</code> - Status codes<br>
                                • <code>http.host</code> - Host header<br>
                                • <code>http.cookie</code> - Cookies<br>
                                • <code>http.user_agent</code> - Browser info<br>
                                <strong>SSL/TLS:</strong><br>
                                • <code>ssl.handshake.type</code> - Handshake phase<br>
                                • <code>tls.handshake.extensions_server_name</code> - SNI</p>
                            </div>
                            <div class="help-card">
                                <h4>DNS Troubleshooting</h4>
                                <p><strong>Key fields:</strong><br>
                                • <code>dns.qry.name</code> - Query name<br>
                                • <code>dns.qry.type</code> - A, AAAA, MX, etc.<br>
                                • <code>dns.flags.response</code> - Query/Response<br>
                                • <code>dns.flags.rcode</code> - Response code<br>
                                • <code>dns.time</code> - Response time<br>
                                <strong>Common issues:</strong><br>
                                • NXDOMAIN (rcode == 3)<br>
                                • Slow responses (dns.time > 0.5)</p>
                            </div>
                            <div class="help-card">
                                <h4>TCP Stream Analysis</h4>
                                <p><strong>Stream tracking:</strong><br>
                                • <code>tcp.stream eq 0</code> - Follow specific stream<br>
                                • <code>tcp.time_delta</code> - Time between packets<br>
                                • <code>tcp.analysis.ack_rtt</code> - Round trip time<br>
                                <strong>Window analysis:</strong><br>
                                • <code>tcp.window_size</code> - Current window<br>
                                • <code>tcp.window_size_scalefactor</code> - Scaling<br>
                                <strong>Performance:</strong><br>
                                • <code>tcp.analysis.bytes_in_flight</code> - Unacked data</p>
                            </div>
                            <div class="help-card">
                                <h4>VoIP/RTP Analysis</h4>
                                <p><strong>SIP signaling:</strong><br>
                                • <code>sip.Method</code> - INVITE, BYE, etc.<br>
                                • <code>sip.Status-Code</code> - Response codes<br>
                                <strong>RTP streams:</strong><br>
                                • <code>rtp.ssrc</code> - Stream identifier<br>
                                • <code>rtp.p_type</code> - Codec type<br>
                                • <code>rtcp.sr.jitter</code> - Jitter measurement<br>
                                <strong>Quality metrics:</strong><br>
                                • Look for packet loss patterns<br>
                                • Check jitter consistency</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="protocol-category">
                        <h4>⚡ Performance Optimization</h4>
                        <div class="help-grid">
                            <div class="help-card">
                                <h4>Filter Efficiency</h4>
                                <p><strong>Fast filters:</strong><br>
                                ✅ Protocol checks (tcp, udp)<br>
                                ✅ IP/Port exact matches<br>
                                ✅ Boolean fields<br><br>
                                <strong>Slow filters:</strong><br>
                                ❌ Regular expressions<br>
                                ❌ Contains on large fields<br>
                                ❌ Frame contains<br><br>
                                <strong>Tip:</strong> Use fast filters first in AND operations.</p>
                            </div>
                            <div class="help-card">
                                <h4>Capture vs Display</h4>
                                <p><strong>Capture filters (BPF):</strong><br>
                                • Applied during capture<br>
                                • Reduces file size<br>
                                • Less CPU intensive<br>
                                • Limited syntax<br><br>
                                <strong>Display filters:</strong><br>
                                • Applied after capture<br>
                                • Full Wireshark syntax<br>
                                • More flexible<br>
                                • Can be CPU intensive</p>
                            </div>
                            <div class="help-card">
                                <h4>Large Capture Tips</h4>
                                <p><strong>Strategies:</strong><br>
                                • Use ring buffers<br>
                                • Set file size limits<br>
                                • Apply capture filters<br>
                                • Use dumpcap for long captures<br><br>
                                <strong>Ring buffer example:</strong><br>
                                <code>-b filesize:100000 -b files:10</code><br>
                                Creates 10 files of 100MB each</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="protocol-category">
                        <h4>🔒 Security Analysis</h4>
                        <div class="help-grid">
                            <div class="help-card">
                                <h4>Attack Detection</h4>
                                <p><strong>Port scanning:</strong><br>
                                <code>tcp.flags.syn==1 && tcp.flags.ack==0</code><br><br>
                                <strong>ARP spoofing:</strong><br>
                                <code>arp.duplicate-address-detected</code><br><br>
                                <strong>DNS tunneling:</strong><br>
                                <code>dns.qry.name.len > 50</code><br><br>
                                <strong>Brute force:</strong><br>
                                Look for repeated failed auth attempts</p>
                            </div>
                            <div class="help-card">
                                <h4>Data Exfiltration</h4>
                                <p><strong>Indicators:</strong><br>
                                • Large outbound transfers<br>
                                • Unusual protocols/ports<br>
                                • Off-hours activity<br>
                                • Encoded data in DNS/ICMP<br><br>
                                <strong>Filters:</strong><br>
                                <code>frame.len > 1400 && ip.dst != local_subnet</code><br>
                                <code>icmp && data.len > 100</code></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="protocol-category">
                        <h4>💡 Troubleshooting Methodology</h4>
                        <div class="help-grid">
                            <div class="help-card">
                                <h4>Step-by-Step Approach</h4>
                                <p><strong>1. Identify symptoms</strong><br>
                                • Slow performance?<br>
                                • Connection failures?<br>
                                • Intermittent issues?<br><br>
                                <strong>2. Capture strategically</strong><br>
                                • Both endpoints if possible<br>
                                • Include problem period<br>
                                • Capture enough context<br><br>
                                <strong>3. Analyze systematically</strong><br>
                                • Start with Expert Info<br>
                                • Check TCP analysis flags<br>
                                • Follow streams<br>
                                • Look for patterns</p>
                            </div>
                            <div class="help-card">
                                <h4>Common Patterns</h4>
                                <p><strong>Network latency:</strong><br>
                                • High TCP RTT<br>
                                • Delayed ACKs<br>
                                • Large time deltas<br><br>
                                <strong>Packet loss:</strong><br>
                                • Retransmissions<br>
                                • Duplicate ACKs<br>
                                • Missing segments<br><br>
                                <strong>Application issues:</strong><br>
                                • HTTP 4xx/5xx errors<br>
                                • Slow response times<br>
                                • Protocol violations</p>
                            </div>
                            <div class="help-card">
                                <h4>Resolution Paths</h4>
                                <p><strong>Performance issues:</strong><br>
                                ✓ Check window scaling<br>
                                ✓ Verify MTU/MSS<br>
                                ✓ Look for congestion<br><br>
                                <strong>Connectivity issues:</strong><br>
                                ✓ Verify routing<br>
                                ✓ Check firewall logs<br>
                                ✓ Validate DNS<br><br>
                                <strong>Application issues:</strong><br>
                                ✓ Review error codes<br>
                                ✓ Check authentication<br>
                                ✓ Verify protocols</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-box success">
                        <h4>🎯 Pro Tips</h4>
                        <ul>
                            <li><strong>Use profiles:</strong> Create custom profiles for different analysis types</li>
                            <li><strong>Color coding:</strong> Set up coloring rules for quick visual analysis</li>
                            <li><strong>Shortcuts:</strong> Learn keyboard shortcuts (Ctrl+F for find, Ctrl+G for go to packet)</li>
                            <li><strong>Statistics:</strong> Use Statistics menu for protocol hierarchy and conversations</li>
                            <li><strong>Export:</strong> Export specific streams or objects for detailed analysis</li>
                            <li><strong>Time reference:</strong> Set time reference points for relative timing analysis</li>
                        </ul>
                    </div>
                    
                    <div class="info-box warning">
                        <h4>⚠️ Common Pitfalls</h4>
                        <ul>
                            <li><strong>Over-filtering:</strong> Don't filter too much initially - you might miss context</li>
                            <li><strong>Wrong interface:</strong> Ensure you're capturing on the correct interface</li>
                            <li><strong>Timestamps:</strong> Check if timestamps are from capture device or original</li>
                            <li><strong>Checksums:</strong> Offloaded checksums may appear invalid</li>
                            <li><strong>Encryption:</strong> Remember you can't analyze encrypted payload without keys</li>
                            <li><strong>Resource usage:</strong> Large captures can consume significant memory</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Scenarios database
        const scenarios = [
            // Network Performance
            {
                name: "TCP Performance Issues",
                icon: "🐌",
                category: "Performance",
                symptoms: "Slow file transfers, application timeouts, poor response times",
                displayFilter: "tcp.analysis.flags",
                captureFilter: "tcp",
                lookFor: ["Retransmissions", "Zero Window", "Duplicate ACKs", "Out of Order packets"],
                resolution: ["Check interface errors", "Verify MTU", "Review QoS policies", "Check for congestion"]
            },
            {
                name: "High Network Latency",
                icon: "⏱️",
                category: "Performance",
                symptoms: "Slow application response, high ping times",
                displayFilter: "tcp.analysis.ack_rtt > 0.2 or frame.time_delta > 0.1",
                captureFilter: "tcp or icmp",
                lookFor: ["High RTT values", "Large time deltas", "Delayed ACKs"],
                resolution: ["Check routing paths", "Verify network congestion", "Review QoS settings"]
            },
            {
                name: "Packet Loss Detection",
                icon: "📉",
                category: "Performance",
                symptoms: "Intermittent connectivity, retransmissions, poor quality",
                displayFilter: "tcp.analysis.retransmission or tcp.analysis.lost_segment",
                captureFilter: "tcp",
                lookFor: ["Retransmissions", "Missing segments", "Duplicate ACKs", "Fast retransmissions"],
                resolution: ["Check physical connections", "Review interface statistics", "Verify duplex settings"]
            },
            
            // Application Issues
            {
                name: "HTTP/HTTPS Errors",
                icon: "🌐",
                category: "Application",
                symptoms: "Web pages not loading, API failures, 4xx/5xx errors",
                displayFilter: "http.response.code >= 400",
                captureFilter: "tcp port 80 or tcp port 443",
                lookFor: ["HTTP status codes", "Error messages", "Timeout patterns"],
                resolution: ["Check web server logs", "Verify authentication", "Review application configuration"]
            },
            {
                name: "DNS Resolution Issues",
                icon: "🔍",
                category: "Application",
                symptoms: "Cannot resolve hostnames, slow name resolution",
                displayFilter: "dns.flags.rcode != 0 or dns.time > 0.5",
                captureFilter: "udp port 53",
                lookFor: ["NXDOMAIN responses", "SERVFAIL", "Slow responses", "Timeout"],
                resolution: ["Verify DNS server connectivity", "Check DNS configuration", "Review DNS cache"]
            },
            {
                name: "Database Slow Queries",
                icon: "🗄️",
                category: "Application",
                symptoms: "Application timeouts, slow data retrieval",
                displayFilter: "mysql or postgresql or tds",
                captureFilter: "tcp port 3306 or tcp port 5432 or tcp port 1433",
                lookFor: ["Query execution time", "Large result sets", "Connection delays"],
                resolution: ["Optimize queries", "Check database indexes", "Review connection pooling"]
            },
            
            // VoIP/Media
            {
                name: "VoIP Call Quality Issues",
                icon: "📞",
                category: "VoIP",
                symptoms: "Choppy audio, one-way audio, dropped calls",
                displayFilter: "rtp or rtcp or sip",
                captureFilter: "udp portrange 16384-32767 or port 5060",
                lookFor: ["Packet loss", "Jitter", "Out of order RTP", "Codec mismatches"],
                resolution: ["Check QoS configuration", "Verify bandwidth", "Review codec settings"]
            },
            {
                name: "SIP Registration Failures",
                icon: "📵",
                category: "VoIP",
                symptoms: "Phones not registering, authentication failures",
                displayFilter: "sip.Method == REGISTER and sip.Status-Code >= 400",
                captureFilter: "port 5060 or port 5061",
                lookFor: ["401 Unauthorized", "403 Forbidden", "Registration timeouts"],
                resolution: ["Verify credentials", "Check SIP server", "Review firewall rules"]
            },
            {
                name: "Video Streaming Issues",
                icon: "📺",
                category: "Media",
                symptoms: "Buffering, pixelation, stream interruptions",
                displayFilter: "rtsp or rtp or http.content_type contains \"video\"",
                captureFilter: "tcp port 554 or udp",
                lookFor: ["Packet loss", "Bandwidth limitations", "Buffer underruns"],
                resolution: ["Increase bandwidth", "Check CDN performance", "Optimize encoding"]
            },
            
            // Security
            {
                name: "Port Scanning Detection",
                icon: "🔍",
                category: "Security",
                symptoms: "Suspicious connection attempts, security alerts",
                displayFilter: "tcp.flags.syn==1 and tcp.flags.ack==0 and tcp.flags.rst==1",
                captureFilter: "tcp[tcpflags] & (tcp-syn) != 0",
                lookFor: ["SYN packets without completion", "Multiple ports targeted", "Rapid connections"],
                resolution: ["Block source IP", "Enable IDS/IPS", "Review firewall logs"]
            },
            {
                name: "SSL/TLS Certificate Issues",
                icon: "🔒",
                category: "Security",
                symptoms: "Certificate warnings, connection failures",
                displayFilter: "ssl.alert_message or ssl.handshake.type == 11",
                captureFilter: "tcp port 443",
                lookFor: ["Certificate validation errors", "Cipher mismatches", "Protocol version issues"],
                resolution: ["Update certificates", "Check certificate chain", "Verify TLS versions"]
            },
            {
                name: "ARP Spoofing/Poisoning",
                icon: "☠️",
                category: "Security",
                symptoms: "Man-in-the-middle attacks, connectivity issues",
                displayFilter: "arp.duplicate-address-detected or arp.duplicate-address-frame",
                captureFilter: "arp",
                lookFor: ["Duplicate ARP responses", "MAC address changes", "Gratuitous ARPs"],
                resolution: ["Enable Dynamic ARP Inspection", "Use static ARP entries", "Implement 802.1X"]
            },
            {
                name: "DNS Tunneling Detection",
                icon: "🚇",
                category: "Security",
                symptoms: "Data exfiltration, suspicious DNS traffic",
                displayFilter: "dns.qry.name.len > 50 or dns.txt",
                captureFilter: "udp port 53",
                lookFor: ["Long domain names", "TXT record queries", "Unusual patterns"],
                resolution: ["Block suspicious domains", "Implement DNS filtering", "Monitor DNS traffic"]
            },
            
            // Cloud/Container
            {
                name: "Kubernetes API Issues",
                icon: "☸️",
                category: "Cloud",
                symptoms: "Pod deployment failures, API errors",
                displayFilter: "http.request.uri contains \"/api/v1\" or http.request.uri contains \"/apis\"",
                captureFilter: "tcp port 6443 or tcp port 8080",
                lookFor: ["401/403 errors", "API timeouts", "Resource conflicts"],
                resolution: ["Check RBAC permissions", "Verify API server", "Review resource limits"]
            },
            {
                name: "Docker Container Network",
                icon: "🐳",
                category: "Container",
                symptoms: "Container connectivity issues, service discovery problems",
                displayFilter: "vxlan or ip.addr == 172.17.0.0/16",
                captureFilter: "udp port 4789",
                lookFor: ["VXLAN encapsulation", "Bridge network issues", "DNS resolution"],
                resolution: ["Check docker network", "Verify overlay network", "Review iptables rules"]
            },
            {
                name: "AWS VPC Flow Issues",
                icon: "☁️",
                category: "Cloud",
                symptoms: "EC2 connectivity problems, security group issues",
                displayFilter: "ip.addr == 169.254.169.254",
                captureFilter: "host 169.254.169.254",
                lookFor: ["Metadata service access", "Security group blocks", "Route table issues"],
                resolution: ["Review security groups", "Check NACLs", "Verify route tables"]
            },
            
            // IoT/SCADA
            {
                name: "MQTT Connection Issues",
                icon: "📡",
                category: "IoT",
                symptoms: "IoT devices not connecting, message delivery failures",
                displayFilter: "mqtt",
                captureFilter: "tcp port 1883 or tcp port 8883",
                lookFor: ["CONNECT failures", "Authentication issues", "QoS problems"],
                resolution: ["Verify broker configuration", "Check credentials", "Review topic permissions"]
            },
            {
                name: "Modbus Communication",
                icon: "🏭",
                category: "SCADA",
                symptoms: "PLC communication failures, timeout errors",
                displayFilter: "modbus",
                captureFilter: "tcp port 502",
                lookFor: ["Exception responses", "Timeout patterns", "Function code errors"],
                resolution: ["Check device addressing", "Verify register mappings", "Review timeout settings"]
            },
            
            // Email
            {
                name: "SMTP Delivery Issues",
                icon: "📧",
                category: "Email",
                symptoms: "Emails not sending, delivery delays",
                displayFilter: "smtp.response.code >= 400",
                captureFilter: "tcp port 25 or tcp port 587",
                lookFor: ["4xx/5xx errors", "Authentication failures", "Relay denied"],
                resolution: ["Check authentication", "Verify relay settings", "Review SPF/DKIM"]
            },
            {
                name: "IMAP Sync Problems",
                icon: "📬",
                category: "Email",
                symptoms: "Email client sync issues, folder problems",
                displayFilter: "imap.response contains \"NO\" or imap.response contains \"BAD\"",
                captureFilter: "tcp port 143 or tcp port 993",
                lookFor: ["IMAP errors", "Authentication issues", "Folder sync problems"],
                resolution: ["Check credentials", "Verify folder subscriptions", "Review mailbox quotas"]
            },
            
            // File Transfer
            {
                name: "SMB/CIFS File Access",
                icon: "📁",
                category: "File Transfer",
                symptoms: "Cannot access network shares, permission denied",
                displayFilter: "smb2.nt_status != 0x00000000",
                captureFilter: "tcp port 445",
                lookFor: ["Access denied", "Authentication failures", "Path not found"],
                resolution: ["Check permissions", "Verify credentials", "Review share configuration"]
            },
            {
                name: "FTP Transfer Issues",
                icon: "📤",
                category: "File Transfer",
                symptoms: "FTP uploads/downloads failing, connection issues",
                displayFilter: "ftp.response.code >= 400",
                captureFilter: "tcp port 21 or tcp port 20",
                lookFor: ["4xx/5xx errors", "Passive mode issues", "Data connection problems"],
                resolution: ["Check firewall rules", "Verify passive mode", "Review permissions"]
            },
            
            // Advanced Analysis
            {
                name: "TCP Zero Window",
                icon: "🪟",
                category: "Advanced",
                symptoms: "Application freezes, data transfer stops",
                displayFilter: "tcp.analysis.zero_window",
                captureFilter: "tcp",
                lookFor: ["Zero window advertisements", "Window probes", "Buffer exhaustion"],
                resolution: ["Check application processing", "Review system resources", "Optimize buffer sizes"]
            },
            {
                name: "Multicast Traffic Issues",
                icon: "📢",
                category: "Advanced",
                symptoms: "Multicast streams not received, IPTV problems",
                displayFilter: "igmp or pim",
                captureFilter: "igmp or host 224.0.0.0/4",
                lookFor: ["IGMP joins/leaves", "PIM messages", "TTL issues"],
                resolution: ["Verify IGMP snooping", "Check multicast routing", "Review TTL settings"]
            },
            {
                name: "TCP Out-of-Order",
                icon: "🔀",
                category: "Advanced",
                symptoms: "Performance degradation, retransmissions",
                displayFilter: "tcp.analysis.out_of_order",
                captureFilter: "tcp",
                lookFor: ["Sequence number gaps", "Reordering patterns", "Path changes"],
                resolution: ["Check for multiple paths", "Review load balancing", "Verify network topology"]
            },
            {
                name: "Microbursts Detection",
                icon: "💥",
                category: "Advanced",
                symptoms: "Intermittent packet loss, buffer overflows",
                displayFilter: "frame.time_delta < 0.00001",
                captureFilter: "",
                lookFor: ["Rapid packet bursts", "Buffer drops", "Queue overflow"],
                resolution: ["Implement traffic shaping", "Increase buffer sizes", "Review QoS policies"]
            },
            
            // Broadcast/Multicast
            {
                name: "Broadcast Storm",
                icon: "⛈️",
                category: "L2/Broadcast",
                symptoms: "Network slowdown, high CPU on devices",
                displayFilter: "eth.dst == ff:ff:ff:ff:ff:ff",
                captureFilter: "ether broadcast",
                lookFor: ["Excessive broadcasts", "Loops", "Flooding"],
                resolution: ["Enable storm control", "Check for loops", "Review STP configuration"]
            },
            {
                name: "DHCP Issues",
                icon: "🏷️",
                category: "L2/Broadcast",
                symptoms: "Clients not getting IP addresses",
                displayFilter: "bootp.option.dhcp",
                captureFilter: "udp port 67 or udp port 68",
                lookFor: ["DHCP Discover without Offer", "NAK responses", "Relay issues"],
                resolution: ["Check DHCP scope", "Verify relay agents", "Review VLAN configuration"]
            },
            
            // Routing
            {
                name: "OSPF Adjacency Issues",
                icon: "🗺️",
                category: "Routing",
                symptoms: "OSPF neighbors not forming, routes missing",
                displayFilter: "ospf",
                captureFilter: "proto 89",
                lookFor: ["Hello mismatches", "MTU issues", "Authentication failures"],
                resolution: ["Check hello/dead timers", "Verify area configuration", "Match MTU settings"]
            },
            {
                name: "BGP Session Problems",
                icon: "🌍",
                category: "Routing",
                symptoms: "BGP peer down, routes not advertised",
                displayFilter: "bgp",
                captureFilter: "tcp port 179",
                lookFor: ["TCP connection issues", "BGP notifications", "Hold timer expiry"],
                resolution: ["Verify peer configuration", "Check AS numbers", "Review route policies"]
            }
        ];
        
        // Templates database
        const templates = [
            // Basic filters
            {
                name: "TCP Retransmissions",
                category: "Performance",
                displayFilter: "tcp.analysis.retransmission",
                description: "Find all TCP retransmitted packets"
            },
            {
                name: "HTTP Errors",
                category: "Web",
                displayFilter: "http.response.code >= 400",
                description: "HTTP 4xx and 5xx error responses"
            },
            {
                name: "DNS Queries",
                category: "DNS",
                displayFilter: "dns.flags.response == 0",
                description: "All DNS query packets"
            },
            {
                name: "Large Packets",
                category: "General",
                displayFilter: "frame.len > 1400",
                description: "Packets larger than 1400 bytes"
            },
            {
                name: "TCP SYN Packets",
                category: "TCP",
                displayFilter: "tcp.flags.syn == 1",
                description: "TCP connection initiations"
            },
            {
                name: "ARP Traffic",
                category: "L2",
                displayFilter: "arp",
                description: "All ARP requests and responses"
            },
            {
                name: "ICMP Traffic",
                category: "Network",
                displayFilter: "icmp",
                description: "All ICMP packets"
            },
            {
                name: "SSL/TLS Handshake",
                category: "Security",
                displayFilter: "ssl.handshake",
                description: "SSL/TLS handshake packets"
            },
            {
                name: "FTP Commands",
                category: "File Transfer",
                displayFilter: "ftp.request.command",
                description: "FTP command channel"
            },
            {
                name: "DHCP Traffic",
                category: "Network",
                displayFilter: "bootp",
                description: "DHCP/BOOTP messages"
            },
            {
                name: "Email Traffic",
                category: "Email",
                displayFilter: "smtp or pop or imap",
                description: "Email protocols"
            },
            {
                name: "VoIP Signaling",
                category: "VoIP",
                displayFilter: "sip or h323 or mgcp",
                description: "VoIP signaling protocols"
            },
            {
                name: "No Broadcasts",
                category: "General",
                displayFilter: "!eth.dst == ff:ff:ff:ff:ff:ff",
                description: "Exclude broadcast traffic"
            },
            {
                name: "TCP Analysis Flags",
                category: "Analysis",
                displayFilter: "tcp.analysis.flags",
                description: "Any TCP analysis issues"
            },
            {
                name: "Expert Errors",
                category: "Analysis",
                displayFilter: "expert.severity == error",
                description: "Expert Info error level"
            },
            {
                name: "Slow Response",
                category: "Performance",
                displayFilter: "frame.time_delta > 0.1",
                description: "Packets with >100ms delta"
            },
            {
                name: "VLANs",
                category: "L2",
                displayFilter: "vlan",
                description: "VLAN tagged traffic"
            },
            {
                name: "IPv6 Traffic",
                category: "Network",
                displayFilter: "ipv6",
                description: "IPv6 packets only"
            },
            {
                name: "Multicast",
                category: "Network",
                displayFilter: "eth.dst[0] & 1",
                description: "Multicast traffic"
            },
            {
                name: "TCP RST",
                category: "TCP",
                displayFilter: "tcp.flags.reset == 1",
                description: "TCP reset packets"
            }
        ];
        
        let filterHistory = [];
        let visualConditionCount = 1;
        let expertFilters = [];
        
        // Initialize
        window.onload = function() {
            loadScenarios();
            loadTemplates();
            loadFilterHistory();
        };
        
        function loadScenarios() {
            const container = document.getElementById('scenariosList');
            const categories = [...new Set(scenarios.map(s => s.category))];
            
            let html = '';
            categories.forEach(category => {
                html += `<h4 style="color: #0077be; margin-top: 20px;">${category}</h4>`;
                const categoryScenarios = scenarios.filter(s => s.category === category);
                categoryScenarios.forEach(scenario => {
                    html += `
                        <div class="scenario-card" onclick="loadScenario('${scenario.name}')">
                            <h4>${scenario.icon} ${scenario.name}</h4>
                            <p style="color: #666; margin: 10px 0;"><strong>Symptoms:</strong> ${scenario.symptoms}</p>
                            <p style="font-family: monospace; background: #f5f5f5; padding: 8px; border-radius: 4px;">
                                ${scenario.displayFilter || scenario.captureFilter}
                            </p>
                        </div>
                    `;
                });
            });
            container.innerHTML = html;
        }
        
        function loadTemplates() {
            const container = document.getElementById('templatesList');
            container.innerHTML = templates.map(template => `
                <div class="template-card" onclick="loadTemplate('${template.name}')">
                    <h4 style="color: #0077be;">${template.name}</h4>
                    <p style="color: #888; font-size: 12px; margin-bottom: 10px;">${template.category}</p>
                    <p style="color: #666; margin-bottom: 10px;">${template.description}</p>
                    <code style="background: #f5f5f5; padding: 8px; border-radius: 4px; display: block; font-size: 12px;">
                        ${template.displayFilter}
                    </code>
                </div>
            `).join('');
        }
        
        function loadScenario(scenarioName) {
            const scenario = scenarios.find(s => s.name === scenarioName);
            if (scenario) {
                clearForm();
                document.getElementById('customFilter').value = scenario.displayFilter || '';
                if (scenario.captureFilter) {
                    document.getElementById('filterType').value = 'both';
                }
                switchTab('generator');
                generateFilter();
                
                // Add scenario info to analysis
                const analysis = document.getElementById('filterAnalysis');
                let info = '<div style="background: #e8f5e9; padding: 10px; border-radius: 4px; margin-bottom: 10px;">';
                info += `<strong>Scenario:</strong> ${scenario.name}<br>`;
                info += `<strong>Look for:</strong> ${scenario.lookFor.join(', ')}<br>`;
                info += `<strong>Resolution:</strong> ${scenario.resolution.join(', ')}`;
                info += '</div>';
                analysis.innerHTML = info + analysis.innerHTML;
            }
        }
        
        function loadTemplate(templateName) {
            const template = templates.find(t => t.name === templateName);
            if (template) {
                clearForm();
                document.getElementById('customFilter').value = template.displayFilter;
                document.getElementById('filterType').value = 'display';
                switchTab('generator');
                generateFilter();
            }
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        function applyQuickFilter(filter) {
            const customFilter = document.getElementById('customFilter');
            if (customFilter.value) {
                customFilter.value += ' and ' + filter;
            } else {
                customFilter.value = filter;
            }
            generateFilter();
        }
        
        function generateFilter() {
            const filterType = document.getElementById('filterType').value;
            const outputFormat = document.getElementById('outputFormat').value;
            
            let displayFilter = '';
            let captureFilter = '';
            
            // Check for custom filter first
            const customFilter = document.getElementById('customFilter').value;
            if (customFilter) {
                if (filterType === 'display' || filterType === 'both') {
                    displayFilter = customFilter;
                }
                if (filterType === 'capture' || filterType === 'both') {
                    captureFilter = customFilter;
                }
            } else {
                // Build filter from form fields
                displayFilter = buildDisplayFilter();
                captureFilter = buildCaptureFilter();
            }
            
            // Generate output based on format
            let output = '';
            const iface = document.getElementById('interface').value;
            
            switch(outputFormat) {
                case 'wireshark':
                    if (displayFilter) {
                        output = `Display Filter:\n${displayFilter}`;
                    }
                    if (captureFilter) {
                        output += `\n\nCapture Filter:\n${captureFilter}`;
                    }
                    break;
                    
                case 'tshark':
                    output = `tshark -i ${iface}`;
                    if (captureFilter && filterType !== 'display') {
                        output += ` -f "${captureFilter}"`;
                    }
                    if (displayFilter && filterType !== 'capture') {
                        output += ` -Y "${displayFilter}"`;
                    }
                    break;
                    
                case 'dumpcap':
                    output = `dumpcap -i ${iface}`;
                    if (captureFilter) {
                        output += ` -f "${captureFilter}"`;
                    }
                    break;
                    
                case 'tcpdump':
                    output = `tcpdump -i ${iface}`;
                    if (captureFilter) {
                        output += ` "${captureFilter}"`;
                    }
                    break;
            }
            
            // Display output
            document.getElementById('filterOutput').textContent = output;
            document.getElementById('outputSection').style.display = 'block';
            
            // Analyze filter performance
            analyzeFilterPerformance(displayFilter || captureFilter);
            
            // Add to history
            if (displayFilter || captureFilter) {
                addToHistory(displayFilter || captureFilter);
            }
        }
        
        function buildDisplayFilter() {
            const filters = [];
            
            // IP filters
            const srcIP = document.getElementById('srcIP').value;
            const dstIP = document.getElementById('dstIP').value;
            const anyIP = document.getElementById('anyIP').value;
            const ipOp = document.getElementById('ipOperator').value;
            
            if (anyIP) {
                filters.push(`ip.addr ${ipOp} ${anyIP}`);
            } else {
                if (srcIP) filters.push(`ip.src ${ipOp} ${srcIP}`);
                if (dstIP) filters.push(`ip.dst ${ipOp} ${dstIP}`);
            }
            
            // Port filters
            const srcPort = document.getElementById('srcPort').value;
            const dstPort = document.getElementById('dstPort').value;
            
            if (srcPort) {
                if (srcPort.includes('{')) {
                    filters.push(`tcp.srcport in ${srcPort} or udp.srcport in ${srcPort}`);
                } else {
                    filters.push(`tcp.srcport == ${srcPort} or udp.srcport == ${srcPort}`);
                }
            }
            if (dstPort) {
                if (dstPort.includes('{')) {
                    filters.push(`tcp.dstport in ${dstPort} or udp.dstport in ${dstPort}`);
                } else {
                    filters.push(`tcp.dstport == ${dstPort} or udp.dstport == ${dstPort}`);
                }
            }
            
            // Protocol
            const protocol = document.getElementById('protocol').value;
            if (protocol) {
                filters.push(protocol);
            }
            
            // TCP Flags
            const tcpFlags = [];
            if (document.getElementById('tcpSyn').checked) tcpFlags.push('tcp.flags.syn == 1');
            if (document.getElementById('tcpAck').checked) tcpFlags.push('tcp.flags.ack == 1');
            if (document.getElementById('tcpFin').checked) tcpFlags.push('tcp.flags.fin == 1');
            if (document.getElementById('tcpRst').checked) tcpFlags.push('tcp.flags.reset == 1');
            if (document.getElementById('tcpPsh').checked) tcpFlags.push('tcp.flags.push == 1');
            if (document.getElementById('tcpUrg').checked) tcpFlags.push('tcp.flags.urg == 1');
            
            if (tcpFlags.length > 0) {
                filters.push('(' + tcpFlags.join(' or ') + ')');
            }
            
            // Advanced filters
            const frameContains = document.getElementById('frameContains').value;
            if (frameContains) filters.push(`frame contains "${frameContains}"`);
            
            const regex = document.getElementById('regex').value;
            if (regex) filters.push(`frame matches "${regex}"`);
            
            const frameLen = document.getElementById('frameLen').value;
            if (frameLen) {
                const op = document.getElementById('frameLenOp').value;
                filters.push(`frame.len ${op} ${frameLen}`);
            }
            
            const vlanId = document.getElementById('vlanId').value;
            if (vlanId) filters.push(`vlan.id == ${vlanId}`);
            
            // Time filters
            const timeDelta = document.getElementById('timeDelta').value;
            if (timeDelta) filters.push(`frame.time_delta > ${timeDelta}`);
            
            // Analysis filters
            const tcpAnalysis = [];
            if (document.getElementById('tcpRetrans').checked) tcpAnalysis.push('tcp.analysis.retransmission');
            if (document.getElementById('tcpZeroWin').checked) tcpAnalysis.push('tcp.analysis.zero_window');
            if (document.getElementById('tcpOutOrder').checked) tcpAnalysis.push('tcp.analysis.out_of_order');
            if (document.getElementById('tcpDupAck').checked) tcpAnalysis.push('tcp.analysis.duplicate_ack');
            if (document.getElementById('tcpFastRetrans').checked) tcpAnalysis.push('tcp.analysis.fast_retransmission');
            
            if (tcpAnalysis.length > 0) {
                filters.push('(' + tcpAnalysis.join(' or ') + ')');
            }
            
            // Expert info
            const expertInfo = document.getElementById('expertInfo').value;
            if (expertInfo) filters.push(`expert.severity == ${expertInfo}`);
            
            // HTTP status
            const httpStatus = document.getElementById('httpStatus').value;
            if (httpStatus) {
                if (httpStatus.includes('>')) {
                    filters.push(`http.response.code ${httpStatus}`);
                } else {
                    filters.push(`http.response.code == ${httpStatus}`);
                }
            }
            
            return filters.join(' and ');
        }
        
        function buildCaptureFilter() {
            const filters = [];
            
            // IP filters
            const srcIP = document.getElementById('srcIP').value;
            const dstIP = document.getElementById('dstIP').value;
            const anyIP = document.getElementById('anyIP').value;
            
            if (anyIP) {
                filters.push(`host ${anyIP}`);
            } else {
                if (srcIP) filters.push(`src host ${srcIP}`);
                if (dstIP) filters.push(`dst host ${dstIP}`);
            }
            
            // Port filters
            const srcPort = document.getElementById('srcPort').value;
            const dstPort = document.getElementById('dstPort').value;
            
            if (srcPort) filters.push(`src port ${srcPort}`);
            if (dstPort) filters.push(`dst port ${dstPort}`);
            
            // Protocol
            const protocol = document.getElementById('protocol').value;
            if (protocol === 'tcp' || protocol === 'udp' || protocol === 'icmp') {
                filters.push(protocol);
            }
            
            // VLAN
            const vlanId = document.getElementById('vlanId').value;
            if (vlanId) filters.push(`vlan ${vlanId}`);
            
            return filters.join(' and ');
        }
        
        function analyzeFilterPerformance(filter) {
            const indicator = document.getElementById('perfIndicator');
            let performance = 'fast';
            let className = 'perf-fast';
            
            if (filter.includes('matches') || filter.includes('contains')) {
                performance = 'slow';
                className = 'perf-slow';
            } else if (filter.includes('tcp.analysis') || filter.includes('expert')) {
                performance = 'medium';
                className = 'perf-medium';
            }
            
            indicator.textContent = `⚡ Performance: ${performance}`;
            indicator.className = 'performance-indicator ' + className;
            
            // Provide analysis
            const analysis = document.getElementById('filterAnalysis');
            let tips = '<ul>';
            
            if (filter.includes('matches')) {
                tips += '<li>⚠️ Regular expressions are CPU intensive</li>';
            }
            if (filter.includes('frame contains')) {
                tips += '<li>⚠️ Frame contains searches entire packet</li>';
            }
            if (filter.includes('==') || filter.includes('!=')) {
                tips += '<li>✅ Exact matches are efficient</li>';
            }
            if (filter.includes('tcp.port') || filter.includes('udp.port')) {
                tips += '<li>✅ Port filters are optimized</li>';
            }
            
            tips += '</ul>';
            analysis.innerHTML = tips;
        }
        
        function addToHistory(filter) {
            // Remove if already exists
            filterHistory = filterHistory.filter(f => f !== filter);
            // Add to beginning
            filterHistory.unshift(filter);
            // Keep only last 10
            filterHistory = filterHistory.slice(0, 10);
            // Save to localStorage
            localStorage.setItem('wiresharkFilterHistory', JSON.stringify(filterHistory));
            // Update display
            displayHistory();
        }
        
        function loadFilterHistory() {
            const saved = localStorage.getItem('wiresharkFilterHistory');
            if (saved) {
                filterHistory = JSON.parse(saved);
                displayHistory();
            }
        }
        
        function displayHistory() {
            const container = document.getElementById('historyList');
            if (filterHistory.length === 0) {
                container.innerHTML = '<p style="color: #666;">No filter history yet</p>';
                return;
            }
            
            container.innerHTML = filterHistory.map((filter, index) => `
                <div class="history-item" onclick="loadFromHistory('${index}')">
                    <span style="font-family: monospace; font-size: 12px;">${filter}</span>
                    <button class="favorite-btn" onclick="event.stopPropagation(); toggleFavorite('${index}')">☆</button>
                </div>
            `).join('');
        }
        
        function loadFromHistory(index) {
            const filter = filterHistory[index];
            document.getElementById('customFilter').value = filter;
            generateFilter();
        }
        
        function clearForm() {
            document.getElementById('filterForm').reset();
            document.getElementById('outputSection').style.display = 'none';
            expertFilters = [];
        }
        
        function validateFilter() {
            const filter = document.getElementById('filterOutput').textContent;
            alert('Filter syntax appears valid!\n\nNote: For complete validation, test in Wireshark.');
        }
        
        function saveToHistory() {
            const filter = document.getElementById('customFilter').value || buildDisplayFilter();
            if (filter) {
                addToHistory(filter);
                alert('Filter saved to history!');
            }
        }
        
        function exportFilter() {
            const filter = document.getElementById('filterOutput').textContent;
            const blob = new Blob([filter], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'wireshark_filter.txt';
            a.click();
        }
        
        function copyFilter() {
            const filter = document.getElementById('filterOutput').textContent;
            navigator.clipboard.writeText(filter).then(() => {
                const btn = event.target;
                btn.textContent = '✓ Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = '📋 Copy';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }
        
        function addVisualCondition() {
            visualConditionCount++;
            const container = document.getElementById('visualConditions');
            const newCondition = document.createElement('div');
            newCondition.className = 'filter-condition';
            newCondition.id = `condition${visualConditionCount}`;
            newCondition.innerHTML = `
                <select class="field-select" onchange="updateFieldOptions(${visualConditionCount})">
                    <option value="">Select Field...</option>
                    <option value="ip.src">Source IP</option>
                    <option value="ip.dst">Destination IP</option>
                    <option value="tcp.port">TCP Port</option>
                    <option value="udp.port">UDP Port</option>
                    <option value="http.request.method">HTTP Method</option>
                    <option value="http.response.code">HTTP Status</option>
                    <option value="dns.qry.name">DNS Query</option>
                    <option value="frame.len">Frame Length</option>
                </select>
                <select class="operator-select">
                    <option value="==">equals</option>
                    <option value="!=">not equals</option>
                    <option value=">">greater than</option>
                    <option value="<">less than</option>
                    <option value="contains">contains</option>
                </select>
                <input type="text" class="value-input" placeholder="Value">
                <select class="logic-operator">
                    <option value="and">AND</option>
                    <option value="or">OR</option>
                </select>
                <button class="remove-condition-btn" onclick="removeVisualCondition(${visualConditionCount})">×</button>
            `;
            container.appendChild(newCondition);
        }
        
        function removeVisualCondition(id) {
            const condition = document.getElementById(`condition${id}`);
            condition.remove();
        }
        
        function buildVisualFilter() {
            const conditions = document.querySelectorAll('.filter-condition');
            let filter = '';
            
            conditions.forEach((condition, index) => {
                const field = condition.querySelector('.field-select').value;
                const operator = condition.querySelector('.operator-select').value;
                const value = condition.querySelector('.value-input').value;
                const logic = condition.querySelector('.logic-operator').value;
                
                if (field && value) {
                    if (index > 0) {
                        filter += ` ${logic} `;
                    }
                    
                    // Add quotes for string values
                    let formattedValue = value;
                    if (operator === 'contains' || field.includes('name') || field.includes('method')) {
                        formattedValue = `"${value}"`;
                    }
                    
                    filter += `${field} ${operator} ${formattedValue}`;
                }
            });
            
            document.getElementById('visualFilterOutput').textContent = filter;
            document.getElementById('visualOutput').style.display = 'block';
            
            // Copy to main filter
            document.getElementById('customFilter').value = filter;
            switchTab('generator');
            generateFilter();
        }
        
        function applyExpertFilter(filter) {
            const btn = event.target;
            btn.classList.toggle('selected');
            
            if (btn.classList.contains('selected')) {
                expertFilters.push(filter);
            } else {
                expertFilters = expertFilters.filter(f => f !== filter);
            }
            
            // Build combined filter
            const combined = expertFilters.join(' or ');
            document.getElementById('expertFilterOutput').textContent = combined || 'No filters selected';
        }
        
        function applyExpertToMain() {
            const expertFilter = document.getElementById('expertFilterOutput').textContent;
            if (expertFilter && expertFilter !== 'No filters selected') {
                document.getElementById('customFilter').value = expertFilter;
                switchTab('generator');
                generateFilter();
            }
        }
        
        function updateFieldOptions(conditionId) {
            // Could dynamically update operator options based on field type
            // For now, keeping all operators available
        }
        
        function updateFilterMode() {
            const filterType = document.getElementById('filterType').value;
            // Update UI based on filter type if needed
        }
        
        function showProtocolOptions() {
            const protocol = document.getElementById('protocol').value;
            // Could show protocol-specific options
            // For now, keeping general options
        }
        
        function toggleFavorite(index) {
            // Implement favorite functionality
            alert('Favorite feature coming soon!');
        }
    </script>
</body>
</html>